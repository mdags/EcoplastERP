--select Code, TableName from Station where GCRecord is null and IsLastStation = 0 order by Code

--select S.Code as [StationCode], S.TableName, M.Code as [MachineCode] from Machine M inner join Station S on S.Oid = M.Station where M.GCRecord is null order by S.Code, M.Code

select M.Code as [MachineCode], W.SequenceNumber, W.WorkOrderNumber, W.WorkOrderDate, P.Name as [WorkName], C.Name as [ContactName], O.OrderNumber+'/'+cast(D.LineNumber as varchar(5)) as [OrderNumber], O.OrderDate as [OrderDate], D.LineDeliveryDate, P.Width, P.Height, P.Thickness, P.Lenght, D.cQuantity as [OrderedQuantity], W.Quantity as [WorkOrderQuantity], (select isnull(SUM(cQuantity), 0) from Store where GCRecord is null and Warehouse = S.SourceWarehouse and Product = P.Oid) as [StoreQuantity], (select isnull(SUM(GrossQuantity), 0) from Production where GCRecord is null and WorkOrderNumber = W.WorkOrderNumber) as [ProductionQuantity], (case when W.Quantity - (select isnull(SUM(GrossQuantity), 0) from Production where GCRecord is null and WorkOrderNumber = W.WorkOrderNumber) > 0 then W.Quantity - (select isnull(SUM(GrossQuantity), 0) from Production where GCRecord is null and WorkOrderNumber = W.WorkOrderNumber) else 0 end) as [RemainingProductionQuantity], (select isnull(SUM(GrossQuantity), 0) from Wastage where GCRecord is null and WorkOrderNumber = W.WorkOrderNumber) as [WastageQuantity], (select isnull(SUM(GrossQuantity), 0) from Production where GCRecord is null and SalesOrderDetail = D.Oid and IsLastProduction = 1) as [SalesOrderQuantity], ((case when W.Quantity - (select isnull(SUM(GrossQuantity), 0) from Production where GCRecord is null and WorkOrderNumber = W.WorkOrderNumber) > 0 then W.Quantity - (select isnull(SUM(GrossQuantity), 0) from Production where GCRecord is null and WorkOrderNumber = W.WorkOrderNumber) else 0 end) / (M.Capacity / 24)) as [RemainingTime], (case when (((select isnull(SUM(GrossQuantity), 0) from Production where GCRecord is null and WorkOrderNumber = W.WorkOrderNumber) * 100) / W.Quantity) <= 100 then (((select isnull(SUM(GrossQuantity), 0) from Production where GCRecord is null and WorkOrderNumber = W.WorkOrderNumber) * 100) / W.Quantity) else 100 end) as [US], (case when (((select isnull(SUM(GrossQuantity), 0) from Production where GCRecord is null and SalesOrderDetail = D.Oid and IsLastProduction = 1) * 100) / D.cQuantity) <= 100 then (((select isnull(SUM(GrossQuantity), 0) from Production where GCRecord is null and SalesOrderDetail = D.Oid and IsLastProduction = 1) * 100) / D.cQuantity) else 0 end) as [SS] from FilmingWorkOrder W inner join SalesOrderDetail D on D.Oid = W.SalesOrderDetail inner join SalesOrder O on O.Oid = D.SalesOrder inner join Contact C on C.Oid = O.Contact inner join Product P on P.Oid = D.Product inner join Station S on S.Oid = W.Station inner join Machine M on M.Oid = W.Machine where W.GCRecord is null and M.Code = 'LM132'