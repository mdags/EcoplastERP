declare @year int, @month int, @lastmonthfirstday date, @lastmonthlastday date, @firstday date, @lastday date
set @year = 2017	set @month = 7
select @lastmonthfirstday = dateadd(month, datediff(month, 0, cast(@year as nvarchar(4))+'-'+cast(@month as nvarchar(2))+'-01')-1, 0)
select @lastmonthlastday = dateadd(day,-(day(cast(@year as nvarchar(4))+'-'+cast(@month as nvarchar(2))+'-01')), cast(@year as nvarchar(4))+'-'+cast(@month as nvarchar(2))+'-01')
select @firstday = cast(convert(datetime, convert(char(4), @year)+right('0'+convert(varchar, @month), 2)+'01') as date)
select @lastday = dateadd(s,-1,dateadd(m, 1, dateadd(mm, datediff(m, 1, cast(@year as nvarchar(4))+'-'+cast(@month as nvarchar(2))+'-01'), 0)))
select CG.Name as [Kapasite Grubu], FK.Name as [Film Çeþidi], S.Code, M.Code as [Makine], M.Capacity as [Kapasite (ay/kg)], CT.Rate as [Makine Film Oraný (%)], case when (M.Capacity * CT.Rate / 100) = 0 then 1 else (M.Capacity * CT.Rate / 100) end as [Makine Aylýk Film Kapasitesi (ay/kg)], (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and ProductionDate between @lastmonthfirstday and @lastmonthlastday and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) between @lastmonthfirstday and @lastmonthlastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) as [Geçen Ay Gerçekleþen Üretim (kg)], (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and ProductionDate between @lastmonthfirstday and @lastmonthlastday and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) between @lastmonthfirstday and @lastmonthlastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) / (case when (M.Capacity * CT.Rate / 100) = 0 then 1 else (M.Capacity * CT.Rate / 100) end) * 100 as [Geçen Ay Gerçekleþen Üretim Oraný (%)]
, (case when S.Name = 'Baský' then ((select isnull(SUM(Quantity), 0) from PrintingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and PrintingWorkOrder in (select Oid from PrintingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Laminasyon' then ((select isnull(SUM(Quantity), 0) from LaminationWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and LaminationWorkOrder in (select Oid from LaminationWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Çekim' then ((select isnull(SUM(Quantity), 0) from FilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and FilmingWorkOrder in (select Oid from FilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Rejenere' then ((select isnull(SUM(Quantity), 0) from RegeneratedWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and RegeneratedWorkOrder in (select Oid from RegeneratedWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Kesim' then ((select isnull(SUM(Quantity), 0) from CuttingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and CuttingWorkOrder in (select Oid from CuttingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Dilme' then ((select isnull(SUM(Quantity), 0) from SlicingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and SlicingWorkOrder in (select Oid from SlicingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Cast Aktarma' then ((select isnull(SUM(Quantity), 0) from CastTransferingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and CastTransferingWorkOrder in (select Oid from CastTransferingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Balonlu Çekim' then ((select isnull(SUM(Quantity), 0) from BalloonFilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and BalloonFilmingWorkOrder in (select Oid from BalloonFilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Cast Dilme' then ((select isnull(SUM(Quantity), 0) from CastSlicingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and CastSlicingWorkOrder in (select Oid from CastSlicingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Cast Rejenere' then ((select isnull(SUM(Quantity), 0) from CastRegeneratedWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and CastRegeneratedWorkOrder in (select Oid from CastRegeneratedWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Cast Çekim' then ((select isnull(SUM(Quantity), 0) from CastFilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and CastFilmingWorkOrder in (select Oid from CastFilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Eco6' then ((select isnull(SUM(Quantity), 0) from Eco6WorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and Eco6WorkOrder in (select Oid from Eco6WorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Eco6 Kesim' then ((select isnull(SUM(Quantity), 0) from Eco6CuttingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and Eco6CuttingWorkOrder in (select Oid from Eco6CuttingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Eco6 Laminasyon' then ((select isnull(SUM(Quantity), 0) from Eco6LaminationWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and Eco6LaminationWorkOrder in (select Oid from Eco6LaminationWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
else 0 end) as [Geçmiþ Aylardan Devir Miktar (kg)]
, (case when S.Name = 'Baský' then ((select isnull(SUM(Quantity), 0) from PrintingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and PrintingWorkOrder in (select Oid from PrintingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Laminasyon' then ((select isnull(SUM(Quantity), 0) from LaminationWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and LaminationWorkOrder in (select Oid from LaminationWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Çekim' then ((select isnull(SUM(Quantity), 0) from FilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and FilmingWorkOrder in (select Oid from FilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Rejenere' then ((select isnull(SUM(Quantity), 0) from RegeneratedWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and RegeneratedWorkOrder in (select Oid from RegeneratedWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Kesim' then ((select isnull(SUM(Quantity), 0) from CuttingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and CuttingWorkOrder in (select Oid from CuttingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Dilme' then ((select isnull(SUM(Quantity), 0) from SlicingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and SlicingWorkOrder in (select Oid from SlicingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Cast Aktarma' then ((select isnull(SUM(Quantity), 0) from CastTransferingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and CastTransferingWorkOrder in (select Oid from CastTransferingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Balonlu Çekim' then ((select isnull(SUM(Quantity), 0) from BalloonFilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and BalloonFilmingWorkOrder in (select Oid from BalloonFilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Cast Dilme' then ((select isnull(SUM(Quantity), 0) from CastSlicingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and CastSlicingWorkOrder in (select Oid from CastSlicingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Cast Rejenere' then ((select isnull(SUM(Quantity), 0) from CastRegeneratedWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and CastRegeneratedWorkOrder in (select Oid from CastRegeneratedWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Cast Çekim' then ((select isnull(SUM(Quantity), 0) from CastFilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and CastFilmingWorkOrder in (select Oid from CastFilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Eco6' then ((select isnull(SUM(Quantity), 0) from Eco6WorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and Eco6WorkOrder in (select Oid from Eco6WorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Eco6 Kesim' then ((select isnull(SUM(Quantity), 0) from Eco6CuttingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and Eco6CuttingWorkOrder in (select Oid from Eco6CuttingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Eco6 Laminasyon' then ((select isnull(SUM(Quantity), 0) from Eco6LaminationWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and Eco6LaminationWorkOrder in (select Oid from Eco6LaminationWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) < @firstday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
else 0 end) / M.Capacity * 100 as [Geçmiþ Aylardan Makine Film Oraný (%)]
, (case when S.Name = 'Baský' then ((select isnull(SUM(Quantity), 0) from PrintingWorkOrder where GCRecord is null and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and PrintingWorkOrder in (select Oid from PrintingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Laminasyon' then ((select isnull(SUM(Quantity), 0) from LaminationWorkOrder where GCRecord is null and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and LaminationWorkOrder in (select Oid from LaminationWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Çekim' then ((select isnull(SUM(Quantity), 0) from FilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and FilmingWorkOrder in (select Oid from FilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Rejenere' then ((select isnull(SUM(Quantity), 0) from RegeneratedWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and RegeneratedWorkOrder in (select Oid from RegeneratedWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Kesim' then ((select isnull(SUM(Quantity), 0) from CuttingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and CuttingWorkOrder in (select Oid from CuttingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Dilme' then ((select isnull(SUM(Quantity), 0) from SlicingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and SlicingWorkOrder in (select Oid from SlicingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Cast Aktarma' then ((select isnull(SUM(Quantity), 0) from CastTransferingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and CastTransferingWorkOrder in (select Oid from CastTransferingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Balonlu Çekim' then ((select isnull(SUM(Quantity), 0) from BalloonFilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and BalloonFilmingWorkOrder in (select Oid from BalloonFilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Cast Dilme' then ((select isnull(SUM(Quantity), 0) from CastSlicingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and CastSlicingWorkOrder in (select Oid from CastSlicingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Cast Rejenere' then ((select isnull(SUM(Quantity), 0) from CastRegeneratedWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and CastRegeneratedWorkOrder in (select Oid from CastRegeneratedWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Cast Çekim' then ((select isnull(SUM(Quantity), 0) from CastFilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and CastFilmingWorkOrder in (select Oid from CastFilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Eco6' then ((select isnull(SUM(Quantity), 0) from Eco6WorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and Eco6WorkOrder in (select Oid from Eco6WorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Eco6 Kesim' then ((select isnull(SUM(Quantity), 0) from Eco6CuttingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and Eco6CuttingWorkOrder in (select Oid from Eco6CuttingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Eco6 Laminasyon' then ((select isnull(SUM(Quantity), 0) from Eco6LaminationWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and Eco6LaminationWorkOrder in (select Oid from Eco6LaminationWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
else 0 end) as [Makine Aylýk Doluluðu (kg)] 
, (case when S.Name = 'Baský' then ((select isnull(SUM(Quantity), 0) from PrintingWorkOrder where GCRecord is null and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and PrintingWorkOrder in (select Oid from PrintingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Laminasyon' then ((select isnull(SUM(Quantity), 0) from LaminationWorkOrder where GCRecord is null and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and LaminationWorkOrder in (select Oid from LaminationWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Çekim' then ((select isnull(SUM(Quantity), 0) from FilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and FilmingWorkOrder in (select Oid from FilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Rejenere' then ((select isnull(SUM(Quantity), 0) from RegeneratedWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and RegeneratedWorkOrder in (select Oid from RegeneratedWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Kesim' then ((select isnull(SUM(Quantity), 0) from CuttingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and CuttingWorkOrder in (select Oid from CuttingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Dilme' then ((select isnull(SUM(Quantity), 0) from SlicingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and SlicingWorkOrder in (select Oid from SlicingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Cast Aktarma' then ((select isnull(SUM(Quantity), 0) from CastTransferingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and CastTransferingWorkOrder in (select Oid from CastTransferingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Balonlu Çekim' then ((select isnull(SUM(Quantity), 0) from BalloonFilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and BalloonFilmingWorkOrder in (select Oid from BalloonFilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Cast Dilme' then ((select isnull(SUM(Quantity), 0) from CastSlicingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and CastSlicingWorkOrder in (select Oid from CastSlicingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Cast Rejenere' then ((select isnull(SUM(Quantity), 0) from CastRegeneratedWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and CastRegeneratedWorkOrder in (select Oid from CastRegeneratedWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Cast Çekim' then ((select isnull(SUM(Quantity), 0) from CastFilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and CastFilmingWorkOrder in (select Oid from CastFilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Eco6' then ((select isnull(SUM(Quantity), 0) from Eco6WorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and Eco6WorkOrder in (select Oid from Eco6WorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Eco6 Kesim' then ((select isnull(SUM(Quantity), 0) from Eco6CuttingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and Eco6CuttingWorkOrder in (select Oid from Eco6CuttingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
when S.Name = 'Eco6 Laminasyon' then ((select isnull(SUM(Quantity), 0) from Eco6LaminationWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) - (select isnull(sum(NetQuantity), 0) from Production where GCRecord is null and Eco6LaminationWorkOrder in (select Oid from Eco6LaminationWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and year(LineDeliveryDate) = @year and month(LineDeliveryDate) = @month and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))))) 
else 0 end) / M.Capacity * 100 as [Makine Aylýk Doluluk Oraný (%)]
, (case when S.Name = 'Baský' then (select isnull(SUM(Quantity), 0) from PrintingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Laminasyon' then (select isnull(SUM(Quantity), 0) from LaminationWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Çekim' then (select isnull(SUM(Quantity), 0) from FilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Rejenere' then (select isnull(SUM(Quantity), 0) from RegeneratedWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Kesim' then (select isnull(SUM(Quantity), 0) from CuttingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Dilme' then (select isnull(SUM(Quantity), 0) from SlicingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Cast Aktarma' then (select isnull(SUM(Quantity), 0) from CastTransferingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Balonlu Çekim' then (select isnull(SUM(Quantity), 0) from BalloonFilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Cast Dilme' then (select isnull(SUM(Quantity), 0) from CastSlicingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Cast Rejenere' then (select isnull(SUM(Quantity), 0) from CastRegeneratedWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Cast Çekim' then (select isnull(SUM(Quantity), 0) from CastFilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Eco6' then (select isnull(SUM(Quantity), 0) from Eco6WorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Eco6 Kesim' then (select isnull(SUM(Quantity), 0) from Eco6CuttingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Eco6 Laminasyon' then (select isnull(SUM(Quantity), 0) from Eco6LaminationWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
else 0 end) as [Gelecek Aylarda Üretilecek Miktar (kg)]
, (case when S.Name = 'Baský' then (select isnull(SUM(Quantity), 0) from PrintingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Laminasyon' then (select isnull(SUM(Quantity), 0) from LaminationWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Çekim' then (select isnull(SUM(Quantity), 0) from FilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Rejenere' then (select isnull(SUM(Quantity), 0) from RegeneratedWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Kesim' then (select isnull(SUM(Quantity), 0) from CuttingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Dilme' then (select isnull(SUM(Quantity), 0) from SlicingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Cast Aktarma' then (select isnull(SUM(Quantity), 0) from CastTransferingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Balonlu Çekim' then (select isnull(SUM(Quantity), 0) from BalloonFilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Cast Dilme' then (select isnull(SUM(Quantity), 0) from CastSlicingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Cast Rejenere' then (select isnull(SUM(Quantity), 0) from CastRegeneratedWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Cast Çekim' then (select isnull(SUM(Quantity), 0) from CastFilmingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Eco6' then (select isnull(SUM(Quantity), 0) from Eco6WorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Eco6 Kesim' then (select isnull(SUM(Quantity), 0) from Eco6CuttingWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
when S.Name = 'Eco6 Laminasyon' then (select isnull(SUM(Quantity), 0) from Eco6LaminationWorkOrder where GCRecord is null and WorkOrderStatus < 110 and Machine = M.Oid and SalesOrderDetail in (select Oid from SalesOrderDetail where GCRecord is null and cast(LineDeliveryDate as date) > @lastday and Product in (select Oid from Product where GCRecord is null and FilmCode1 in (select Oid from Reciept where FilmKind = CT.FilmKind)))) 
else 0 end) / M.Capacity * 100 as [Gelecek Aylarda Üretilecek Film Oraný (%)] 
from MachineCapacityTarget CT inner join Machine M on M.Oid = CT.Machine inner join CapacityGroup CG on CG.Oid = CT.CapacityGroup inner join FilmKind FK on FK.Oid = CT.FilmKind inner join Station S on S.Oid = M.Station 
where CT.GCRecord is null and CT.[Year] = @year and CT.[Month] = @month 
order by CG.Name, FK.Name, S.Code, M.Code